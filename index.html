<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscaminas - Bryan Rocha Moreno</title>
  <style>
    body {
      background: #c0c0c0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .game-container {
      background: #bdbdbd;
      border: 4px solid #808080;
      box-shadow: inset 4px 4px #ffffff, inset -4px -4px #808080;
      padding: 10px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #bdbdbd;
      border: 3px solid #7b7b7b;
      box-shadow: inset 3px 3px #fff, inset -3px -3px #7b7b7b;
      padding: 5px 10px;
      margin-bottom: 10px;
    }

    .counter, .timer {
      background: black;
      color: red;
      font-family: monospace;
      font-size: 20px;
      padding: 5px 10px;
      border: 2px inset #7b7b7b;
      width: 60px;
      text-align: right;
    }

    .smiley {
      background: #c0c0c0;
      border: 3px outset #fff;
      width: 30px;
      height: 30px;
      text-align: center;
      line-height: 30px;
      font-size: 22px;
      cursor: pointer;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(8, 30px);
      grid-template-rows: repeat(8, 30px);
      gap: 2px;
    }

    .cell {
      background: #bdbdbd;
      border: 3px outset #fff;
      width: 30px;
      height: 30px;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }

    .cell.revealed {
      border: 3px inset #7b7b7b;
      background: #dcdcdc;
      cursor: default;
    }

    .cell.mine {
      background: red;
    }

    .cell.flag::after {
      content: "ðŸš©";
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="header">
      <div class="counter" id="mineCounter">010</div>
      <div class="smiley" id="resetBtn">ðŸ™‚</div>
      <div class="timer" id="timer">000</div>
    </div>

    <div class="board" id="board"></div>
  </div>

  <script>
    // ðŸ”Š Sonidos del Buscaminas
    const soundClick = new Audio('sounds/click.wav');
    const soundFlag = new Audio('sounds/flag.wav');
    const soundExplosion = new Audio('sounds/explosion.wav');
    const soundWin = new Audio('sounds/win.wav');

    // âš™ï¸ Variables principales
    const rows = 8;
    const cols = 8;
    const mineCount = 10;
    const board = document.getElementById("board");
    const mineCounter = document.getElementById("mineCounter");
    const resetBtn = document.getElementById("resetBtn");
    const timerDisplay = document.getElementById("timer");

    let grid = [];
    let gameOver = false;
    let started = false;
    let timer = null;
    let seconds = 0;

    // ðŸ• Funciones del temporizador
    function startTimer() {
      if (started) return;
      started = true;
      seconds = 0;
      timerDisplay.textContent = "000";
      timer = setInterval(() => {
        if (!gameOver) {
          seconds++;
          if (seconds > 999) seconds = 999;
          timerDisplay.textContent = String(seconds).padStart(3, "0");
        }
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timer);
      started = false;
    }

    // ðŸŽ® Crear tablero
    function createBoard() {
      grid = [];
      board.innerHTML = "";
      gameOver = false;
      started = false;
      resetBtn.textContent = "ðŸ™‚";
      mineCounter.textContent = String(mineCount).padStart(3, "0");
      timerDisplay.textContent = "000";
      stopTimer();

      for (let r = 0; r < rows; r++) {
        const row = [];
        for (let c = 0; c < cols; c++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.dataset.row = r;
          cell.dataset.col = c;
          board.appendChild(cell);
          row.push({ element: cell, mine: false, revealed: false, flagged: false, adjacent: 0 });
        }
        grid.push(row);
      }
      placeMines();
      countAdjacents();
    }

    // ðŸ’£ Colocar minas aleatoriamente
    function placeMines() {
      let minesPlaced = 0;
      while (minesPlaced < mineCount) {
        const r = Math.floor(Math.random() * rows);
        const c = Math.floor(Math.random() * cols);
        if (!grid[r][c].mine) {
          grid[r][c].mine = true;
          minesPlaced++;
        }
      }
    }

    // ðŸ”¢ Contar minas adyacentes
    function countAdjacents() {
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          if (grid[r][c].mine) continue;
          let count = 0;
          for (let dr = -1; dr <= 1; dr++) {
            for (let dc = -1; dc <= 1; dc++) {
              const nr = r + dr, nc = c + dc;
              if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && grid[nr][nc].mine) {
                count++;
              }
            }
          }
          grid[r][c].adjacent = count;
        }
      }
    }

    // ðŸŸ¦ Revelar celda
    function revealCell(r, c) {
      const cell = grid[r][c];
      if (cell.revealed || cell.flagged || gameOver) return;

      startTimer(); // ðŸ• Inicia al primer clic
      cell.revealed = true;
      cell.element.classList.add("revealed");

      if (cell.mine) {
        cell.element.textContent = "ðŸ’£";
        cell.element.classList.add("mine");
        soundExplosion.play();
        endGame(false);
      } else {
        soundClick.play();
        if (cell.adjacent > 0) {
          cell.element.textContent = cell.adjacent;
        } else {
          for (let dr = -1; dr <= 1; dr++) {
            for (let dc = -1; dc <= 1; dc++) {
              const nr = r + dr, nc = c + dc;
              if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) revealCell(nr, nc);
            }
          }
        }
      }

      checkWin();
    }

    // ðŸš© Colocar o quitar bandera
    function toggleFlag(r, c) {
      const cell = grid[r][c];
      if (cell.revealed || gameOver) return;
      cell.flagged = !cell.flagged;
      cell.element.classList.toggle("flag");
      soundFlag.play();
    }

    // ðŸ’€ Terminar juego
    function endGame(win) {
      gameOver = true;
      stopTimer();
      resetBtn.textContent = win ? "ðŸ˜Ž" : "ðŸ’€";
      if (win) soundWin.play();
      else soundExplosion.play();

      if (!win) {
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            if (grid[r][c].mine) grid[r][c].element.textContent = "ðŸ’£";
          }
        }
      }
    }

    // ðŸ Verificar victoria
    function checkWin() {
      let unrevealed = 0;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          if (!grid[r][c].revealed && !grid[r][c].mine) unrevealed++;
        }
      }
      if (unrevealed === 0 && !gameOver) {
        endGame(true);
      }
    }

    // ðŸ–± Eventos
    board.addEventListener("click", (e) => {
      if (e.target.classList.contains("cell")) {
        const r = +e.target.dataset.row;
        const c = +e.target.dataset.col;
        revealCell(r, c);
      }
    });

    board.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      if (e.target.classList.contains("cell")) {
        const r = +e.target.dataset.row;
        const c = +e.target.dataset.col;
        toggleFlag(r, c);
      }
    });

    resetBtn.addEventListener("click", createBoard);

    createBoard();
  </script>
</body>
</html>
